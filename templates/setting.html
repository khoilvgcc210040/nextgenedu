{% load static %}
<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>Settings</title>

    <style>


        .settings {

            width: 100%;

            background-color: white;


            padding: 30px 20px;


            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .settings h2 {
            text-align: center;

            margin-bottom: 20px;


            font-size: 30px;

            font-weight: 700;

            color: var(--accent-color);

        }

        .settings h3 {

            font-size: 20px;

            font-weight: 700;

            position: relative;

            margin-left: 10%;

            color: var(--accent-color);

        }


        .settings-section {

            margin-bottom: 20px;

            border: 1px solid var(--accent-color);


            border-radius: 5px;
            padding: 25px;
            margin: 30px 10%;

        }

        .settings-section label {

            display: block;
            margin-bottom: 5px;

            font-weight: bold;
            color: var(--accent-color);
        }


        .settings-section input[type="text"],

        .settings-section input[type="email"],

        .settings-section input[type="password"],

        .settings-section input[type="number"] {

            width: 50%;

            padding: 10px;

            margin-bottom: 10px;

            border: 1px solid var(--accent-color);

            border-radius: 4px;
        }


        .settings-section input[type="number"] {

            width: 10%;
            display: inline-block;

        }


        .settings-section button {

            width: 100%;
            padding: 10px;
            border: none;

            border-radius: 4px;

            background-color: var(--accent-color);

            color: white;


            font-size: 16px;

            cursor: pointer;

            transition: opacity 0.3s ease-in-out;

        }

        .settings-section button:hover {


            opacity: 0.8;

        }



        .settings-section .switch-container {


            display: flex;


            justify-content: space-between;


            align-items: center;
            padding: 10px;

        }


        .switch-container label {

            font-weight: normal;

            color: var(--accent-color);
        }

        .settings-section .switch {

            position: relative;
            display: inline-block;

            width: 40px;
            height: 20px;
        }



        .switch input {

            opacity: 0;

            width: 0;

            height: 0;

        }


        .slider {


            position: absolute;

            cursor: pointer;

            top: 0;
            left: 0;

            right: 0;


            bottom: 0;


            background-color: #a8a29e;
            transition: .4s;

            border-radius: 20px;


        }


        .slider:before {


            position: absolute;

            content: "";


            height: 14px;

            width: 14px;
            left: 3px;

            bottom: 3px;
            background-color: white;

            transition: .4s;

            border-radius: 50%;


        }



        input:checked + .slider {

            background-color: var(--accent-color);

        }

        input:checked + .slider:before {


            transform: translateX(20px);

        }



        .delete-settings-section {
            display: flex;
            justify-content: center;
        }


        .delete-settings-section button {


            width: 80%;

            background-color: var(--accent-color);
            border: none;

            border-radius: 4px;


            color: white;
            font-size: 16px;

            cursor: pointer;


            padding: 10px;

            transition: background-color 0.3s ease-in-out;

        }

        .delete-settings-section button:hover {


            background-color: #b91c1c;

        }

        .btn-back {
            display: flex;
            height: 3em;
            width: 20%;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            letter-spacing: 1px;
            transition: all 0.2s linear;
            cursor: pointer;
            border: none;
            color: var(--accent-color);
            background: #fff;
        }
    
        .btn-back > svg {
            margin-right: 5px;
            margin-left: 5px;
            font-size: 20px;
            transition: all 0.4s ease-in;
        }
    
        .btn-back:hover > svg {
            font-size: 1.2em;
            transform: translateX(-5px);
        }
    
        .btn-back:hover {
            transform: translateY(-2px);
        }
    </style>
</head>


<body>
{% include "headerMain.html" %}

<div class="settings">
    <div>
        <button class="btn-back" onclick="history.back()" style="outline: none;">
            <svg height="16" width="16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1024 1024">
                <path d="M874.690416 495.52477c0 11.2973-9.168824 20.466124-20.466124 20.466124l-604.773963 0 188.083679 188.083679c7.992021 7.992021 7.992021 20.947078 0 28.939099-4.001127 3.990894-9.240455 5.996574-14.46955 5.996574-5.239328 0-10.478655-1.995447-14.479783-5.996574l-223.00912-223.00912c-3.837398-3.837398-5.996574-9.046027-5.996574-14.46955 0-5.433756 2.159176-10.632151 5.996574-14.46955l223.019353-223.029586c7.992021-7.992021 20.957311-7.992021 28.949332 0 7.992021 8.002254 7.992021 20.957311 0 28.949332l-188.073446 188.073446 604.753497 0C865.521592 475.058646 874.690416 484.217237 874.690416 495.52477z"></path>
            </svg>
            <span>Back</span>
        </button>
    </div> 
    <h2>Settings</h2>



    <form id="personal-info-form" method="POST">
        {% csrf_token %}
        <h3>Personal Information</h3>
        <div class="settings-section">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="{{ user.email }}">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" value="{{ user.username }}">
            <label for="dob">Date of Birth</label>
            <input type="number" id="dob-day" name="dob-day" max="31" min="1" placeholder="Day" value="{{ user.date_of_birth.day }}" oninput="if(value>31)value=31;">
            <input type="number" id="dob-month" name="dob-month" max="12" min="1" placeholder="Month" value="{{ user.date_of_birth.month }}" oninput="if(value>12)value=12;">
            <input type="number" id="dob-year" name="dob-year" max="2024" min="1900" placeholder="Year" value="{{ user.date_of_birth.year }}" oninput="if(value>2024)value=2024;">
            <button type="submit" style="margin-top: 1.5rem;" name="save_changes">Save Changes</button>
        </div>
    </form>
    <form id="password-form" method="POST">
        {% csrf_token %}
        <h3>Password</h3>
        <div class="settings-section">
            <label for="current-password">Current Password</label>
            <input type="password" placeholder="Current Password..." id="current-password" name="current-password">
            <label for="new-password">New Password</label>
            <input type="password" placeholder="New Password..." id="new-password" name="new-password">
            <label for="confirm-password">Confirm New Password</label>
            <input type="password" placeholder="Confirm New Password..." id="confirm-password" name="confirm-password">

            <button type="submit" style="margin-top: 1.5rem;" name="update_password">Update Password</button>
        </div>
    </form>


    <h3>Notifications</h3>

    <div class="settings-section">

        <div class="switch-container">



            <label for="notify-sections">Notify me when sections are added to classrooms</label>



            <label class="switch">



                <input type="checkbox" id="notify-sections" {% if user.notify_sections %}checked{% endif %}>



                <span class="slider"></span>

            </label>

        </div>

    </div>



    <form id="delete-account-form" method="POST">
        {% csrf_token %}
        <h3>Delete Account</h3>
        <div class="settings-section delete-settings-section">
            <button type="submit" name="delete_account">Permanently Delete Your Account</button>
        </div>
    </form>
</div>

<div id="preloader">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
</div>

<!-- Main JS File -->
<script src="{% static 'assets/js/main.js' %}"></script>


</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const personalInfoForm = document.getElementById('personal-info-form');
        const passwordForm = document.getElementById('password-form');
        const deleteAccountForm = document.getElementById('delete-account-form');
        const notifySectionsCheckbox = document.getElementById('notify-sections');

        personalInfoForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(personalInfoForm);
            formData.append('save_changes', 'true');
            fetch('', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: formData
            }).then(response => response.json()).then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    location.reload();
                }
            }).catch(error => console.error('Error:', error));
        });

        passwordForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(passwordForm);
            formData.append('update_password', 'true');
            fetch('', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: formData
            }).then(response => response.json()).then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    location.reload();
                }
            }).catch(error => console.error('Error:', error));
        });

        deleteAccountForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(deleteAccountForm);
            formData.append('delete_account', 'true');
            fetch('', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: formData
            }).then(response => response.json()).then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    window.location.href = data.redirect_url;
                }
            }).catch(error => console.error('Error:', error));
        });

        notifySectionsCheckbox.addEventListener('change', function() {
            const isChecked = notifySectionsCheckbox.checked;
            fetch('{% url "update_notification_preference" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ notify_sections: isChecked })
            }).then(response => {
                if (response.ok) {
                    console.log('Notification preference updated successfully.');
                } else {
                    console.error('Failed to update notification preference.');
                }
            }).catch(error => console.error('Error:', error));
        });
    });
    
</script>
