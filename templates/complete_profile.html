{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <title>Complete Profile</title>
    <link href="{% static 'assets/css/main.css' %}" rel="stylesheet">

</head>

<style>

    @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');

    body, html {
        margin: 0;

        padding: 0;
        height: 100%;

        font-family: "Montserrat", sans-serif;
        overflow-x: hidden;
        overflow-y: auto;

    }

    body {
        display: flex;

        align-items: center;

        justify-content: center;
        background-color: #f0f0f0;

    }
    .split {

        width: 50%;
        height: 100vh;

        overflow: hidden;

    }
    .left {
        background: url('{% static "bg-auth.jpg" %}') no-repeat center center;

        background-size: cover;

        position: fixed; 

        left: 0;
        top: 0;

    }
    .right {
        background: #fff;
        display: flex;

        justify-content: center;
        align-items: center;
        position: absolute;
        right: 0;
        top: 0;

        height: 100vh;

        overflow-y: auto;
    }
    .container {
        position: absolute;

        top: 0px;
        width: 100%;

        max-width: 40rem;
        margin: 20px;
    }

    .form-control {

        width: 100%;

        padding: 15px;

        margin-bottom: 35px;
        border: 0px solid #ccc;

        border-radius: 7px;

        background-color: #f1f5f9;

        font-weight: 600;

    }
    .form-select {

        width: 100%;
        padding: 10px;

        border: 1px solid #ccc;
        border-radius: 4px;

        background-color: white;
    }
    .form-label {
        display: block;

        font-weight: 600;

        font-size: 14px;
        letter-spacing: normal;

        line-height: 1.4285714285714286;

        color: var(--accent-color);
        font-weight: 800;
    }
    .form-check-input[type=checkbox] {
        height: 25px;
        width: 25px;

        border: 1px solid #000;

    }

    .form-check-input[type=checkbox]:checked {

        background-color: var(--accent-color);
        border-color: var(--accent-color);
    }
    .form-submit {

        width: 100%;

        background-color: var(--accent-color);

        color: white;

        font-weight: 600;
        padding: 1.125rem 1.875rem;

        border: none;
        border-radius: 10px;

        cursor: pointer;

        transition: opacity 0.12s cubic-bezier(.47,0,.745,.715);
    }

    .form-submit:hover {
        color: #fff;

        opacity: 0.8;

        transition: all .12s cubic-bezier(.47,0,.745,.715);
    }

    .auth-button {
        font-size: 30px;
        font-weight: 700;
        color: #6c757d; 
        text-decoration: none; 
        transition: color 0.3s;
        margin-bottom: 30px;
    }    

    .error-message{
        border: 2px solid #dc2626;
        margin-bottom: 35px;
        border-radius: 10px;
        padding: 20px 10px;
        font-weight: 600;
        display: none;
    }

    .error-message ul{
        margin-bottom: 0 !important;
    }

    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay d-none" style="z-index: 9999;">
        <div class="spinner-border" style="color: var(--accent-color);" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <div class="split left"></div>
    <div class="split right">

        <div class="container">
            <div class="d-flex justify-content-end">
                <button class="btn btn-outline-danger" onclick="window.location.href='{% url "home" %}';">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                    </svg>
                </button>
            </div>
            <p class="auth-button text-center" style="color: var(--accent-color);" id="signup-btn">✨ Complete Your Profile ✨</p> 
            <div class="error-message" id="error-message">
                <ul class="message-list-signup">
                    <li style="color: #dc2626;">❌ You must accept the Terms of Service and Privacy Policy.</li>
                </ul>
            </div>
            <form id="complete-profile-form" method="post">
                {% csrf_token %}
                <div class="mb-3">

                    <label for="role" class="form-label">Who are you?</label>

                    <select id="role" name="role" style="padding: 10px; color: white; font-weight: 600; border-radius: 6px; border: 1px solid #d1d5da; background-color: var(--accent-color);">

                        <option value="student">Student</option>

                        <option value="teacher">Teacher</option>
                    </select>
                </div>
                <div id="grade-container" class="mb-3">
                    <label for="grade" class="form-label">What grade are you in?</label>
                    <select id="grade" name="grade" style="padding: 10px; color: white; font-weight: 600; border-radius: 6px; border: 1px solid #d1d5da; background-color: var(--accent-color);">
                        <option value="10">10</option>

                        <option value="11">11</option>

                        <option value="12">12</option>

                    </select>
                </div>
                <div id="subject-container" class="mb-3" style="display: none;">
                    <label for="subject" class="form-label">Which subject do you teach?</label>
                    <select id="subject" name="subject" style="padding: 10px; color: white; font-weight: 600; border-radius: 6px; border: 1px solid #d1d5da; background-color: var(--accent-color);">

                        {% for subject in subjects %}

                            <option value="{{ subject.id }}">{{ subject.name }} - Grade {{ subject.grade }}</option>
                        {% endfor %}

                    </select>
                </div>
                <div class="mb-3">
                    <label for="date_of_birth" class="form-label">Date of Birth</label>

                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                        <select id="day" name="day" style="padding: 10px; color: white; font-weight: 600; border-radius: 6px; border: 1px solid #d1d5da; background-color: var(--accent-color);" required></select>
                        <select id="month" name="month" style="padding: 10px; color: white; font-weight: 600; border-radius: 6px; border: 1px solid #d1d5da; background-color: var(--accent-color);" required></select>
                        <select id="year" name="year" style="padding: 10px; color: white; font-weight: 600; border-radius: 6px; border: 1px solid #d1d5da; background-color: var(--accent-color);" required></select>
                    </div>
                </div>
                

                <div class="form-check d-flex align-items-center mb-3">

                    <input type="checkbox" class="form-check-input" id="terms" name="terms">

                    <label class="form-check-label ms-2 mt-1" for="terms">I accept the <a href="" class="text-dark fw-bold">Terms of Service</a> and <a href="" class="text-dark fw-bold">Privacy Policy</a></label>

                </div>

                <button type="submit" class="form-submit">Complete Profile</button>
            </form>

        </div>

    </div>

</body>
</html>
<script>

document.addEventListener('DOMContentLoaded', function() {

    const daySelect = document.getElementById('day');

    for (let i = 1; i <= 31; i++) {
        const option = document.createElement('option');

        option.value = i;

        option.textContent = i;
        daySelect.appendChild(option);
    }

    const monthSelect = document.getElementById('month');
    const monthNames = ["January", "February", "March", "April", "May", "June", 
                    "July", "August", "September", "October", "November", "December"];
    for (let i = 0; i < monthNames.length; i++) {

        const option = document.createElement('option');
        option.value = i + 1;

        option.textContent = monthNames[i];

        monthSelect.appendChild(option);

    }

    const yearSelect = document.getElementById('year');

    const currentYear = new Date().getFullYear();
    for (let i = currentYear; i >= 1900; i--) {
        const option = document.createElement('option');

        option.value = i;

        option.textContent = i;

        yearSelect.appendChild(option);
    }
    

    toggleFields();

});


function toggleFields() {

    var roleSelect = document.getElementById('role');
    var gradeContainer = document.getElementById('grade-container');
    var subjectContainer = document.getElementById('subject-container');
    
    if (roleSelect.value === 'teacher') {

        gradeContainer.style.display = 'none';
        subjectContainer.style.display = 'block';
    } else {

        gradeContainer.style.display = 'block';
        subjectContainer.style.display = 'none';

    }
}


document.getElementById('role').addEventListener('change', toggleFields);

document.getElementById('complete-profile-form').addEventListener('submit', function(event) {
    const loadingOverlay = document.getElementById('loading-overlay');
    loadingOverlay.classList.remove('d-none');

    const termsCheckbox = document.getElementById('terms');
    const errorMessage = document.getElementById('error-message');
    if (!termsCheckbox.checked) {
        event.preventDefault();
        errorMessage.style.display = 'block';
        loadingOverlay.classList.add('d-none');
        return false;
    } else {
        errorMessage.style.display = 'none';
    }
});

window.addEventListener('beforeunload', function() {
    const loadingOverlay = document.getElementById('loading-overlay');
    loadingOverlay.classList.remove('d-none');
});
</script>
